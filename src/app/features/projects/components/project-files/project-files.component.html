<!-- 工具列 -->
<div class="file-toolbar mb-md">
  <div class="toolbar-left">
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <span nz-icon nzType="folder" nzTheme="outline"></span>
        根目錄
      </nz-breadcrumb-item>
      @if (currentPath() !== '/') {
        <nz-breadcrumb-item>{{ currentPath() }}</nz-breadcrumb-item>
      }
    </nz-breadcrumb>
  </div>
  <div class="toolbar-right">
    <button 
      nz-button 
      nzType="primary"
      [nzLoading]="uploading()"
      [disabled]="fileList.length === 0"
      (click)="handleUpload()"
    >
      <span nz-icon nzType="upload" nzTheme="outline"></span>
      上傳檔案
    </button>
  </div>
</div>

<!-- 上傳區域 -->
<nz-card class="mb-md">
  <nz-upload
    nzType="drag"
    [nzMultiple]="true"
    [nzBeforeUpload]="beforeUpload"
    [nzFileList]="fileList"
  >
    <p class="ant-upload-drag-icon">
      <span nz-icon nzType="inbox" nzTheme="outline"></span>
    </p>
    <p class="ant-upload-text">點擊或拖拽檔案到此區域上傳</p>
    <p class="ant-upload-hint">
      支援單個或批量上傳，檔案大小限制 50MB
    </p>
  </nz-upload>
</nz-card>

<!-- 檔案列表 -->
<nz-card nzTitle="檔案列表">
  @if (loading()) {
    <div class="text-center py-lg">
      <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
    </div>
  } @else {
    @if (files().length === 0) {
      <nz-empty nzNotFoundContent="暫無檔案，請上傳檔案"></nz-empty>
    } @else {
      <nz-table
        #fileTable
        [nzData]="files()"
        [nzPageSize]="10"
        [nzShowPagination]="files().length > 10"
      >
        <thead>
          <tr>
            <th>名稱</th>
            <th>大小</th>
            <th>上傳者</th>
            <th>上傳時間</th>
            <th nzWidth="200px">操作</th>
          </tr>
        </thead>
        <tbody>
          @for (file of fileTable.data; track trackByFileId($index, file)) {
            <tr>
              <td>
                <span nz-icon [nzType]="getFileIcon(file)" nzTheme="outline" class="mr-sm"></span>
                {{ file.name }}
              </td>
              <td>{{ formatFileSize(file.size) }}</td>
              <td>{{ file.uploadedBy }}</td>
              <td>{{ formatDate(file.uploadedAt) }}</td>
              <td>
                <button 
                  nz-button 
                  nzType="link" 
                  nzSize="small"
                  (click)="downloadFile(file)"
                >
                  <span nz-icon nzType="download" nzTheme="outline"></span>
                  下載
                </button>
                <button 
                  nz-button 
                  nzType="link" 
                  nzSize="small"
                  nzDanger
                  nz-popconfirm
                  nzPopconfirmTitle="確定要刪除此檔案嗎？"
                  (nzOnConfirm)="deleteFile(file)"
                >
                  <span nz-icon nzType="delete" nzTheme="outline"></span>
                  刪除
                </button>
              </td>
            </tr>
          }
        </tbody>
      </nz-table>
    }
  }
</nz-card>

